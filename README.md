# GuardianVision
Tienda virtual de venta de cámaras


Abrimos una terminal en la capeta raiz del proyecto y ejecutamos

1.- npm install

2.- composer istall

3.- le damos a todo enter y al final en la confirmacion le damos a que si por lo que se nos ha creado un documento .json

4.- Añadir esto al archivo composer.json:

    "autoload": {
        "psr-4": {
            "MVC\\": "./",
            "Controllers\\": "./controllers",
            "Model\\": "./models"
        }
    },

5.- Tras hacer esto en una terminal ponemos:

    composer dump-autoload

    composer install

5- Con eso ya deberiamos poder ejecutarlo 

    - En una terminal poner => npm run dev 


    - En otra terminal poner=>
    Pero antes IMP tienes que cambiar de caperta =>

    cd public
    php -S localhost:3000

-- MySQL Script generated by MySQL Workbench
-- Mon May 12 20:22:11 2025
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering
-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

CREATE database guardianvision;

Drop database guardianvision;

USE guardianvision;

-- -----------------------------------------------------
-- Table `mydb`.`Almacen`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Almacen (
  id_almacen INT NOT NULL PRIMARY KEY auto_increment,
  nombre VARCHAR(100) NOT NULL,
  direccion VARCHAR(200) NOT NULL,
  capacidad INT NOT NULL,
  capacidad_ocupada INT NOT NULL
);

describe Almacen;

drop table Almacen;

-- -----------------------------------------------------
-- Table `mydb`.`Producto`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS Producto (
  cod_producto VARCHAR(20) NOT NULL PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  stock_actual INT NOT NULL,
  stock_minimo INT NOT NULL,
  precio DECIMAL(10,2) NOT NULL,
  ubicacion INT NOT NULL,
  imagen varchar(50) not null,
  FOREIGN KEY (ubicacion) REFERENCES Almacen(id_almacen)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION
);

describe producto;

drop table producto;

-- -----------------------------------------------------
-- Table `mydb`.`Movimiento_Almacen`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Movimiento_Almacen` (
  `id_movimiento` INT NULL,
  `tipo` ENUM('entrada', 'salida') NOT NULL,
  `fecha` DATE NOT NULL,
  `producto_id` VARCHAR(20) NOT NULL,
  `cantidad` INT NOT NULL,
  `almacen_id` INT NOT NULL,
  `origen_operacion` ENUM('compra', 'venta') NOT NULL,
  PRIMARY KEY (`id_movimiento`),
  INDEX `FK_MovAlmacen_Prod_prodID_idx` (`producto_id` ASC) VISIBLE,
  INDEX `FK_MovAlmacen_almacen_id_idx` (`almacen_id` ASC) VISIBLE,
  CONSTRAINT `FK_MovAlmacen_Prod_prodID`
    FOREIGN KEY (`producto_id`)
    REFERENCES `mydb`.`Producto` (`cod_producto`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `FK_MovAlmacen_almacen_id`
    FOREIGN KEY (`almacen_id`)
    REFERENCES `mydb`.`Almacen` (`id_almacen`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`proveedor`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`proveedor` (
  `cod_proveedor` VARCHAR(20) NOT NULL,
  `razon_social` VARCHAR(15) NOT NULL,
  `direccion` VARCHAR(100) NOT NULL,
  `telefono` VARCHAR(15) NOT NULL,
  `email` VARCHAR(34) NOT NULL,
  PRIMARY KEY (`cod_proveedor`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Materia_Prima`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Materia_Prima` (
  `cod_mp` VARCHAR(20) NOT NULL,
  `nombre` VARCHAR(100) NOT NULL,
  `unidad_medida` VARCHAR(20) NULL,
  `stock_actuall` INT NOT NULL,
  `stock_minimo` INT NOT NULL,
  `proveedor` VARCHAR(100) NULL,
  `ubicacion` INT NOT NULL,
  PRIMARY KEY (`cod_mp`),
  INDEX `FK_materiaPrima_almacen_idx` (`ubicacion` ASC) VISIBLE,
  INDEX `FK_proveedor_materiaPrima_idx` (`proveedor` ASC) VISIBLE,
  CONSTRAINT `FK_materiaPrima_almacen`
    FOREIGN KEY (`ubicacion`)
    REFERENCES `mydb`.`Almacen` (`id_almacen`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `FK_proveedor_materiaPrima`
    FOREIGN KEY (`proveedor`)
    REFERENCES `mydb`.`proveedor` (`cod_proveedor`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Empresa`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Empresa` (
  `razon_social` VARCHAR(100) NOT NULL,
  `nif` VARCHAR(15) NOT NULL,
  `direccion` VARCHAR(200) NOT NULL,
  `telefono` VARCHAR(15) NOT NULL,
  `email` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`nif`),
  UNIQUE INDEX `nif_UNIQUE` (`nif` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Configuracion_General`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Configuracion_General` (
  `moneda` VARCHAR(10) NOT NULL,
  `idioma` VARCHAR(20) NOT NULL,
  `pais` VARCHAR(50) NOT NULL)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Configuracion_IVA`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Configuracion_IVA` (
  `porcentaje_iva` DECIMAL(4,2) NOT NULL,
  `fecha_ini_iva` DATE NOT NULL,
  `fecha_fin_iva` DATE NULL,
  PRIMARY KEY (`fecha_ini_iva`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Detalles Venta`
-- -----------------------------------------------------

drop table DetallesVenta;
CREATE TABLE IF NOT EXISTS DetallesVenta (
  idDetallesVenta INT NOT NULL AUTO_INCREMENT,
  Cantidad FLOAT NOT NULL,
  idProducto VARCHAR(20) NOT NULL,
  idVenta INT NOT NULL,
  PRIMARY KEY (idDetallesVenta),
  FOREIGN KEY (idProducto) REFERENCES Producto(cod_producto)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION
);	

drop table Carrito;
CREATE TABLE IF NOT EXISTS Carrito (
  id INT AUTO_INCREMENT PRIMARY KEY,
  Cantidad FLOAT NOT NULL,
  idCliente INT NOT NULL,
  idProducto VARCHAR(20) NOT NULL,
  unique( idCliente ,idProducto,Cantidad ),
  FOREIGN KEY (idProducto) REFERENCES Producto(cod_producto)
	ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  FOREIGN KEY (idCliente) REFERENCES Cliente(id)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION
);	

select * from Carrito;
describe Carrito;



-- -----------------------------------------------------
-- Table `mydb`.`Cliente`
-- -----------------------------------------------------

drop table Cliente;
CREATE TABLE IF NOT EXISTS Cliente (
  id INT AUTO_INCREMENT PRIMARY KEY,
  Nombre VARCHAR(45) NOT NULL,
  Direccion VARCHAR(45) NOT NULL,
  Telefono VARCHAR(45) NOT NULL,
  Email VARCHAR(45) NOT NULL,
  contraseña varchar(45) not null
  );
  
  select * from Cliente;



-- -----------------------------------------------------
-- Table `mydb`.`Envio`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Envio` (
  `idEnvio` INT NOT NULL AUTO_INCREMENT,
  `Fecha_inicio` VARCHAR(45) NOT NULL,
  `Fecha_entrega` VARCHAR(45) NOT NULL,
  `Emprresa_envio` VARCHAR(45) NOT NULL,
  `Estado` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`idEnvio`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Intalacion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Intalacion` (
  `idIntalacion` INT NOT NULL AUTO_INCREMENT,
  `Fecha` DATE NOT NULL,
  `Direccion` VARCHAR(45) NOT NULL,
  `Precio` FLOAT NOT NULL,
  PRIMARY KEY (`idIntalacion`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Venta`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Venta` (
  `idVenta` INT NOT NULL AUTO_INCREMENT,
  `Fecha` DATE NOT NULL,
  `pago_total` FLOAT NOT NULL,
  `forma_pago` VARCHAR(45) NOT NULL,
  `tipo_envio` VARCHAR(45) NOT NULL,
  `idIntalacion` INT NULL DEFAULT 0,
  `idEnvio` INT NULL DEFAULT 0,
  `idDetallesVenta` INT NOT NULL,
  `idCliente` INT NOT NULL,
  `idProducto` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`idVenta`),
  INDEX `Detalles_idx` (`idDetallesVenta` ASC) VISIBLE,
  INDEX `Cliente_idx` (`idCliente` ASC) VISIBLE,
  INDEX `Envio_idx` (`idEnvio` ASC) VISIBLE,
  INDEX `Intalacion_idx` (`idIntalacion` ASC) VISIBLE,
  CONSTRAINT `Detalles`
    FOREIGN KEY (`idDetallesVenta`)
    REFERENCES `mydb`.`Detalles Venta` (`idDetallesVenta`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `Cliente`
    FOREIGN KEY (`idCliente`)
    REFERENCES `mydb`.`Cliente` (`idCliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `Envio`
    FOREIGN KEY (`idEnvio`)
    REFERENCES `mydb`.`Envio` (`idEnvio`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `Intalacion`
    FOREIGN KEY (`idIntalacion`)
    REFERENCES `mydb`.`Intalacion` (`idIntalacion`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`pedido`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`pedido` (
  `cod_pedido` VARCHAR(45) NOT NULL,
  `fecha_pedido` VARCHAR(45) NOT NULL,
  `cod_proveedor` VARCHAR(45) NOT NULL,
  `estado` ENUM('pendiente', 'recibido', 'cancelado') NOT NULL,
  PRIMARY KEY (`cod_pedido`),
  INDEX `cod_proveedor_idx` (`cod_proveedor` ASC) VISIBLE,
  CONSTRAINT `cod_proveedor`
    FOREIGN KEY (`cod_proveedor`)
    REFERENCES `mydb`.`proveedor` (`cod_proveedor`)
    ON DELETE NO ACTION
    ON UPDATE CASCADE)



-- -----------------------------------------------------
-- Table `mydb`.`detalle_pedido`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`detalle_pedido` (
  `cod_pedido` VARCHAR(45) NOT NULL,
  `cod_producto` VARCHAR(45) NOT NULL,
  `cantidad` INT NOT NULL,
  `precio_unitario` DECIMAL NOT NULL,
  PRIMARY KEY (`cod_pedido`, `cod_producto`),
  INDEX `cod_producto_idx` (`cod_producto` ASC) VISIBLE,
  CONSTRAINT `cod_pedido`
    FOREIGN KEY (`cod_pedido`)
    REFERENCES `mydb`.`pedido` (`cod_pedido`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `cod_producto`
    FOREIGN KEY (`cod_producto`)
    REFERENCES `mydb`.`pedido` (`cod_pedido`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Albaran`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Albaran` (
  `cod_albaran` VARCHAR(30) NOT NULL,
  `fecha_recepcion` DATE NOT NULL,
  `cod_pedido` VARCHAR(45) NOT NULL,
  `estado_recepcion` ENUM('pendiente', 'completo') NOT NULL,
  `observaciones` TEXT(100) NOT NULL,
  PRIMARY KEY (`cod_albaran`),
  INDEX `cod_pedido_idx` (`cod_pedido` ASC) VISIBLE,
  CONSTRAINT `cod_pedido`
    FOREIGN KEY (`cod_pedido`)
    REFERENCES `mydb`.`pedido` (`cod_pedido`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);
    


INSERT INTO Almacen ( nombre, direccion, capacidad, capacidad_ocupada)
VALUES 
('Almacén Central', 'Calle Seguridad 123, Madrid', 1000, 350),
('Almacén Sevilla', 'Avenida Videovigilancia 45, Sevilla', 800, 400);

drop table Producto;

INSERT INTO Producto (cod_producto, nombre, stock_actual, stock_minimo, precio, ubicacion, imagen)
VALUES 
('CAM123', 'Cámara IP Full HD', 150, 50, 89.99, 1, 'CámaraIPFullHD'),
('SEN789', 'Sensor Movimiento WiFi', 200, 50, 29.90, 1, 'SensorMovimientoWiFi'),
('DVR001', 'Grabador DVR 8 canales con salida HDMI', 60, 15, 159.00, 2, 'GrabadorDVR8canalesconsalidaHDMI'),
('DISK01', 'Disco Duro 2TB para Videovigilancia', 100, 20, 89.50, 1, 'DiscoDuro2TBparaVideovigilancia'),
('CAM126', 'Cámara PTZ Motorizada Full HD', 50, 10, 199.99, 1, 'CámaraPTZMotorizadaFullHD'),
('KIT458', 'Kit de instalación universal', 200, 50, 24.95, 2, 'Kitdeinstalaciónuniversal'),
('SEN791', 'Sensor de humo inalámbrico', 120, 30, 34.95, 1, 'Sensordehumoinalámbrico');


select * FROM Producto;

INSERT INTO proveedor (cod_proveedor, razon_social, direccion, telefono, email)
VALUES 
('PRO001', 'SegurTech S.A.', 'Pol. Ind. Norte, Barcelona', '912345678', 'contacto@segurtech.com'),
('PRO002', 'VisionMax Ltd.', 'C/ Lentes 33, Valencia', '934567891', 'ventas@visionmax.com');


INSERT INTO Materia_Prima (cod_mp, nombre, unidad_medida, stock_actuall, stock_minimo, proveedor, ubicacion)
VALUES 
('MP001', 'Placa base cámara IP', 'unidad', 500, 100, 'PRO001', 1),
('MP002', 'Lente angular 90°', 'unidad', 300, 80, 'PRO002', 2);


INSERT INTO Cliente (Nombre, Direccion, Telefono, Email)
VALUES 
('Ana López', 'Calle Vigilancia 3, Málaga', '654123456', 'ana.lopez@gmail.com'),
('Carlos Ruiz', 'Av. Seguridad 22, Madrid', '622334455', 'carlos.ruiz@hotmail.com');


INSERT INTO `Detalles Venta` (Cantidad, idProducto, idVenta)
VALUES 
(2, 'CAM123', 1),
(1, 'KIT456', 1);

INSERT INTO Venta (idVenta, Fecha, pago_total, forma_pago, tipo_envio, idDetallesVenta, idCliente, idProducto)
VALUES 
(1, '2025-05-10', 479.93, 'Tarjeta', 'Estándar', 1, 1, 'CAM123');


INSERT INTO pedido (cod_pedido, fecha_pedido, cod_proveedor, estado)
VALUES 
('PED001', '2025-05-05', 'PRO001', 'pendiente');

INSERT INTO detalle_pedido (cod_pedido, cod_producto, cantidad, precio_unitario)
VALUES 
('PED001', 'CAM123', 100, 60.00);


INSERT INTO Albaran (cod_albaran, fecha_recepcion, cod_pedido, estado_recepcion, observaciones)
VALUES 
('ALB001', '2025-05-08', 'PED001', 'pendiente', 'Revisar embalaje al recibir');